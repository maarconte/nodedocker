version: '3.7'

services:
    api:
        build: ./api/
        ports:
            - 8081:8090
        secrets:
            - POSTGRES_USER
            - POSTGRES_PASSWORD
        depends_on:
            - db

    db:
        image: postgres
        restart: always
        environment:
            - POSTGRES_DB=postgres
            - POSTGRES_USER_FILE=/run/secrets/POSTGRES_USER
            - POSTGRES_PASSWORD_FILE=/run/secrets/POSTGRES_PASSWORD
        secrets:
            - POSTGRES_USER
            - POSTGRES_PASSWORD
        ports:
            - 5432:5432

secrets:
    POSTGRES_USER:
        file: ./secrets/user
    POSTGRES_PASSWORD:
        file: ./secrets/password